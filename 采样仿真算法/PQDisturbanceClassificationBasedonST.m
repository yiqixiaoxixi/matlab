%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Power Quality Disturbance Classification Based on S Transform and
% Fourier Transform:
% 基于S变换与傅里叶变换的的电能质量多扰动分类识别;
%
% DESCRIPTION: 该算法根据唐求老师论文编写;
% modification history: see git log
% --------------------
% 01a, 07/08/2015, 李建闽 written
% --------------------
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% 初始化软件运行环境;
% Initialize the software environment;
% Tips:
% clear removes all variables from the workspace.
% clear VARIABLES does the same thing.
% clear GLOBAL removes all global variables.
% clear FUNCTIONS removes all compiled MATLAB and MEX-functions.
% clear ALL removes all variables, globals, functions and MEX links.
clear all;%清除工作空间;
clc;%清除命令窗口显示;
%% 设置仿真基本参数
fs=5120;%采样率;
f0=50;%电网基波频率;
N=10*fs/f0;%采样点数(总共10个周波);
n=0:N-1;%时间序列;
t=n/fs;%时间间隔;
TRUE=1;
FALSE=0;
addnoise=TRUE;%加不加白噪声;
snr=30;%设置信噪比(dB);
%% 电能质量扰动信号模型仿真
%% ----正常电压:信号x1----
x1=sin(2*pi*f0*n/fs);%正常电压信号;
if addnoise
    x1=noisegen(x1,snr);
end
[st1_sig,st1_t,st1_f] = st(hilbert(x1'));%S变换
x1_t=max(abs(st1_sig));%找出各个列向量的最大值;
% 求得Tup,Tdown,Tinter
Tupindex=find(x1_t>1.1);%查找电压骤升的点;
if(isempty(Tupindex))%有可能为空;
    Tup=0;
else
    Tup=(Tupindex(end)-Tupindex(1))/fs;
end
Tdownindex=find(x1_t<0.9);%查找电压骤降的点;
if(isempty(Tdownindex))
    Tdown=0;
else
    Tdown=(Tdownindex(end)-Tdownindex(1))/fs;
end
Tinterindex=find(x1_t<0.1);%查找电压中断的点;
if(isempty(Tinterindex))
    Tinter=0;
else
    Tinter=(Tinterindex(end)-Tinterindex(1))/fs;
end
disp('-----正常电压信号-----');
disp(['正常电压信号骤升时间是:' num2str(Tup) ' 骤降时间是：' num2str(Tdown) ' 中断时间是：' num2str(Tinter)]);
% 时域幅值超过标准值10%;
% 求均值和标准差;
x1tmean=mean(x1_t);
x1tstd=std(x1_t);
disp(['正常电压信号时域特性曲线的均值是:' num2str(x1tmean)]);
disp(['正常电压信号时域特性曲线的标准差是:' num2str(x1tstd)]);
x1_f=max(abs(st1_sig),[],2);%找出各个行向量的最大值;
%求峰值
pks=findpeaks(x1_f(10:end));
pks(pks<0.05)=0;%谐波幅值小于0.05均置为零;
if length(pks)==1
    disp(['正常电压信号p1:' num2str(pks(1)) ' p2:0 p3:0']);
elseif length(pks)==2
    disp(['正常电压信号p1:' num2str(pks(1)) ' p2:' num2str(pks(2)) ' p3:0']);
else
    disp(['正常电压信号p1:' num2str(pks(1)) ' p2:' num2str(pks(1)) ' p3:' num2str(pks(3))]);
end
% 求均值和标准差;
x1fmean=mean(x1_f);
x1fstd=std(x1_f);
disp(['正常电压信号频域特性曲线的均值是:' num2str(x1fmean)]);
disp(['正常电压信号频域特性曲线的标准差是:' num2str(x1fstd)]);

%% ----电压骤升:信号x2----
a2=0.1+rand(1,1)*0.7;%骤升比例系数(0.1~0.8之间随机分布)
t1=0;%起始时刻;
t2=0;%结束时刻;
while (t2-t1<0.02)||(t2-t1 > 0.18)%不满足约束条件:T<t2-t1<9T，则一直为真；
    t1=rand(1,1)*0.18;%0.02=<t2-t1=<0.18;
    t2=0.02+rand(1,1)*0.18;
end
ntemp=0:N-1;%阶跃信号整个时间序列长度
u1step=(ntemp-t1*fs)>=0;%求出t1的阶跃序列(阶跃点为t1/(1/fs));
u2step=(ntemp-t2*fs)>=0;%求出t2的阶跃序列;
x2=(1+a2*(u1step-u2step)).*sin(2*pi*f0*n/fs);%信号x2;
if addnoise
    x2=noisegen(x2,snr);
end
[st2_sig,st2_t,st2_f] = st(hilbert(x2'));
x2_t=max(abs(st2_sig));%找出各个列向量的最大值;
%求得Tup,Tdown,Tinter
Tupindex=find(x2_t>1.1);
if(isempty(Tupindex))
    Tup=0;
else
    Tup=(Tupindex(end)-Tupindex(1))/fs;
end
Tdownindex=find(x2_t<0.9);
if(isempty(Tdownindex))
    Tdown=0;
else
    Tdown=(Tdownindex(end)-Tdownindex(1))/fs;
end
Tinterindex=find(x2_t<0.1);
if(isempty(Tinterindex))
    Tinter=0;
else
    Tinter=(Tinterindex(end)-Tinterindex(1))/fs;
end
disp('-----骤升电压信号-----');
disp(['骤升电压信号起始时刻t1：' num2str(t1) ' 结束时刻t2：' num2str(t2) ' 骤升时间是:' num2str(Tup) ' 骤降时间是：' num2str(Tdown) ' 中断时间是：' num2str(Tinter)]);
%求均值和标准差;
x2tmean=mean(x2_t);
x2tstd=std(x2_t);
disp(['电压骤升信号时域特性曲线的均值是:' num2str(x2tmean)]);
disp(['电压骤升信号时域特性曲线的标准差是:' num2str(x2tstd)]);
x2_f=max(abs(st2_sig),[],2);%找出各个行向量的最大值;
%求峰值
pks=findpeaks(x2_f(10:end));
if length(pks)==1
    disp(['电压骤升信号p1:' num2str(pks(1)) ' p2:0 p3:0']);
elseif length(pks)==2
    disp(['电压骤升信号p1:' num2str(pks(1)) ' p2:' num2str(pks(2)) ' p3:0']);
else
    disp(['电压骤升信号p1:' num2str(pks(1)) ' p2:' num2str(pks(1)) ' p3:' num2str(pks(3))]);
end
%求均值和标准差;
x2fmean=mean(x2_f);
x2fstd=std(x2_f);
disp(['电压骤升信号频域特性曲线的均值是:' num2str(x2fmean)]);
disp(['电压骤升信号频域特性曲线的标准差是:' num2str(x2fstd)]);

%% ----电压骤降信号:x3----
a3=0.1+rand(1,1)*0.8;%骤降电压比例系数(0.1~0.9之间的随机分布);
t1=0;
t2=0;
while (t2-t1<0.02)||(t2-t1 > 0.18)%不满足约束条件:T<t2-t1<9T，则一直为真；
    t1=rand(1,1)*0.18;%0.02=<t2-t1=<0.18;
    t2=0.02+rand(1,1)*0.18;
end
ntemp=0:N-1;
u1step=(ntemp-t1*fs)>=0;%
u2step=(ntemp-t2*fs)>=0;%
x3=(1-a3*(u1step-u2step)).*sin(2*pi*f0*n/fs);%电压骤降信号;
if addnoise
    x3=noisegen(x3,snr);
end
[st3_sig,st3_t,st3_f] = st(hilbert(x3'));
x3_t=max(abs(st3_sig));%找出各个列向量的最大值;
%求得Tup,Tdown,Tinter
Tupindex=find(x3_t>1.1);
if(isempty(Tupindex))
    Tup=0;
else
    Tup=(Tupindex(end)-Tupindex(1))/fs;
end
Tdownindex=find(x3_t<0.9);
if(isempty(Tdownindex))
    Tdown=0;
else
    Tdown=(Tdownindex(end)-Tdownindex(1))/fs;
end
Tinterindex=find(x3_t<0.1);
if(isempty(Tinterindex))
    Tinter=0;
else
    Tinter=(Tinterindex(end)-Tinterindex(1))/fs;
end
disp('-----骤降电压信号-----');
disp(['骤降电压信号起始时刻t1：' num2str(t1) ' 结束时刻t2：' num2str(t2) ' 骤升时间是:' num2str(Tup) ' 骤降时间是：' num2str(Tdown) ' 中断时间是：' num2str(Tinter)]);
%求均值和标准差;
x3tmean=mean(x3_t);
x3tstd=std(x3_t);
disp(['电压骤降信号时域特性曲线的均值是:' num2str(x3tmean)]);
disp(['电压骤降信号时域特性曲线的标准差是:' num2str(x3tstd)]);
x3_f=max(abs(st3_sig),[],2);%找出各个行向量的最大值;
%求峰值
pks=findpeaks(x3_f(10:end));
if length(pks)==1
    disp(['电压骤降信号p1:' num2str(pks(1)) ' p2:0 p3:0']);
elseif length(pks)==2
    disp(['电压骤降信号p1:' num2str(pks(1)) ' p2:' num2str(pks(2)) ' p3:0']);
else
    disp(['电压骤降信号p1:' num2str(pks(1)) ' p2:' num2str(pks(1)) ' p3:' num2str(pks(3))]);
end
x3fmean=mean(x3_f);
x3fstd=std(x3_f);
disp(['电压骤降信号频域特性曲线的均值是:' num2str(x3fmean)]);
disp(['电压骤降信号频域特性曲线的标准差是:' num2str(x3fstd)]);

%% ----电压中断:信号x4----
a4=0.9+rand(1,1)*0.1;%电压中断比例系数(在0.9~1.0之间随机变动);
t1=0;
t2=0;
while (t2-t1<0.02)||(t2-t1 > 0.18)%不满足约束条件:T<t2-t1<9T，则一直为真；
    t1=rand(1,1)*0.18;%0.02=<t2-t1=<0.18;
    t2=0.02+rand(1,1)*0.18;
end
ntemp=0:N-1;
u1step=(ntemp-t1*fs)>=0;
u2step=(ntemp-t2*fs)>=0;
x4=(1-a4*(u1step-u2step)).*sin(2*pi*f0*n/fs);%电压骤降的信号模型;

x4=[-0.00857185553148149,0.0827226525399043,0.114040206268593,0.136991123818591,0.243669869266618,0.318233106989149,0.343209252085550,0.418248135075488,0.474616084232594,0.511216599898839,0.577525446105138,0.595856234198644,0.657774236573180,0.729387059747940,0.747896824187416,0.793902589773795,0.820597600997406,0.861698064071719,0.922752404964823,0.883402369335130,0.954439441111848,0.959539165750660,1.00259029914437,0.994534031861336,0.997065080826770,1.03505609389599,1.02615815847464,1.01264764316437,0.984762881052548,0.977117058916999,0.979235131722337,0.929548398380642,0.929767714572222,0.911998723237394,0.872176746835397,0.835915831968119,0.811089501547795,0.763244159611906,0.725058870012717,0.690805503682880,0.615905311174148,0.580387904948610,0.513651946265077,0.499892310099893,0.405629175195867,0.359835647417851,0.282633697424240,0.269429058595860,0.174135678846063,0.146009174668509,0.110263231176055,0.00974830054646202,-0.0223482803300044,-0.100494953933583,-0.166661173157218,-0.269510113006347,-0.281150121822898,-0.369038174515241,-0.424327102113942,-0.458254835790701,-0.534853640947426,-0.555590360077979,-0.624094553221276,-0.675743934026354,-0.713894026920932,-0.751546136843120,-0.773016456876546,-0.830013622039992,-0.838526948919642,-0.906575828944207,-0.905980101608215,-0.913021334415882,-0.924599015285261,-0.976617085200588,-1.02061541618204,-0.972825922766951,-0.983936040056745,-0.960149039529305,-1.02021414985566,-0.984670388920918,-0.985809018920190,-0.934222077387624,-0.914886080771832,-0.933152613488137,-0.869677477518480,-0.849930524628535,-0.833456696764511,-0.812216098202172,-0.786580591890853,-0.737616271941074,-0.703851624326226,-0.667009176659301,-0.559493217014810,-0.534988908033603,-0.519700338036936,-0.427658949601728,-0.386576359024189,-0.309770263259405,-0.250387119383544,-0.189962383186741,-0.156510171371883,-0.0424619501874855,-0.00529036202416961,0.0100490853370038,0.0794454294785978,0.181630279083550,0.183909021314386,0.292969030963328,0.319313126442084,0.376905937540646,0.465184754746331,0.540313328296934,0.562014820956453,0.582526582517909,0.640698817738561,0.695263231097230,0.750063855884848,0.777462918523112,0.824946814078549,0.841860383486541,0.896527204747218,0.885496843795478,0.921753305670962,0.910793003884046,0.950782605120269,0.986472949001752,0.995261949915991,1.01856002995237,1.05125430654120,0.988331645352111,1.01171359337597,0.985420362827116,0.973614080521456,0.928211247307670,0.942369921714606,0.909040137011155,0.860547057505783,0.853798876365750,0.797630172178902,0.773766554207127,0.728465982830190,0.694501712502111,0.646598257885447,0.611770748581152,0.545772316815155,0.503620818121127,0.439077943146651,0.427305815874706,0.335499798689218,0.270261372341115,0.202811051020874,0.178231715387623,0.102793111538795,-0.00763232891710736,-0.0228683358618741,-0.0761140450877074,-0.170404180323795,-0.192554140632958,-0.307147794446421,-0.291983486937238,-0.390892709539447,-0.432708503733326,-0.521755795048010,-0.542779377422009,-0.581802939610098,-0.679245644588093,-0.674845779504275,-0.726130570640222,-0.805798861692547,-0.801033451801805,-0.843971063743634,-0.858002391615611,-0.915627881540182,-0.966350788736999,-0.946970373850944,-0.969557655361078,-0.992576729799889,-1.00104906121148,-1.01417732870406,-0.990424186265249,-0.977810244602977,-1.01268164236614,-0.987239374868500,-0.965242831557085,-0.970644103373630,-0.914631623686569,-0.901641909830809,-0.860689025006257,-0.859365892494918,-0.817239347962569,-0.768700324872041,-0.756818341068848,-0.729604103254545,-0.654762776872212,-0.630440131673449,-0.573558934564220,-0.551498132764863,-0.431850482135511,-0.416501926238657,-0.342236133843521,-0.301839691441196,-0.213616159661651,-0.136198964317449,-0.118611311390139,-0.0750201853449556,0.00621717144311797,0.0736259120618181,0.140054848040659,0.165272635626234,0.256654181794404,0.311801489511289,0.334808985331135,0.433620757054284,0.459890536191047,0.506548392416878,0.561408131081935,0.617543826480142,0.654663258738045,0.725472933219434,0.741667422486856,0.824549377545786,0.826803995459146,0.888074700505669,0.890327416586826,0.915758257453524,0.970104344480974,0.954053054623559,0.987984787140669,0.999303918890038,1.01539705717273,1.03253747988244,1.03188987759333,1.01855769070311,0.984333561525917,0.990377115747393,0.967929667458917,0.977867777118392,0.941464971535080,0.901410869344858,0.854912031989640,0.844438717124796,0.769695087215849,0.746699350519152,0.725268919381183,0.669437153580650,0.651010286046924,0.597236253903792,0.517607804668590,0.483400733538173,0.424170030364384,0.341487471803915,0.289609790101452,0.244957749466212,0.194084682528743,0.125265294788735,0.0633627653539815,0.00549717223909824,-0.0554207132732560,-0.0990691311934406,-0.207810002280598,-0.242700628274117,-0.328848753758449,-0.390269187388011,-0.413069620009969,-0.462925155975364,-0.538243054924690,-0.596987215264061,-0.638561640285690,-0.660999493960062,-0.681340609375247,-0.763013127036332,-0.760733559752747,-0.828089876538869,-0.869766698261311,-0.923177913683888,-0.923350116113119,-0.943632966070797,-0.947744384300204,-0.973644195354559,-1.00645567907359,-0.973157921692374,-1.00397624145613,-1.00536503845424,-0.998259934078089,-0.980649525707376,-1.00117049743886,-0.944287501354291,-0.939276374865004,-0.876321328946026,-0.922084311545399,-0.884029091023498,-0.872860560481210,-0.792512850345557,-0.751580330411822,-0.735013080651554,-0.687738459940212,-0.639718567262668,-0.603872966684326,-0.534174526368984,-0.485698591304920,-0.396230409068558,-0.379852642541655,-0.345194670958675,-0.239935919525782,-0.192045831103982,-0.144084075139242,-0.0601232622319314,-0.0337331719575592,0.0601986135652581,0.127723077475597,0.172490846175227,0.234042274462445,0.292702528621560,0.336233839932779,0.396489679316057,0.492293048076022,0.524349844597979,0.591453395480872,0.617553988358675,0.681649986214336,0.717307438385814,0.743572200300978,0.804273291843985,0.842779688078466,0.816154485397156,0.867151943245746,0.899876465023688,0.939925566654527,0.917370718418487,0.986431576238174,0.970168928253662,1.00103445443340,1.01820281744940,0.990752928013102,1.00994379340378,1.00472371498819,0.959490732477677,0.960985798719003,0.966940722564444,0.918452402525355,0.924888556785710,0.861846461124976,0.839066825605576,0.818300813807439,0.752312401792273,0.705239247242950,0.663924433880241,0.676485551970716,0.623998295221633,0.534067477338480,0.530634069376530,0.425242851761351,0.388269479956035,0.322788400300277,0.274453446625065,0.218460426323377,0.154148145465899,0.0931955006103178,0.0230988570552751,-0.0395082193292926,-0.0938160197577273,-0.184071880861926,-0.220020447070916,-0.267408648264424,-0.335214601424439,-0.414824757478219,-0.444689052065306,-0.550806731041532,-0.566296181551518,-0.586624011308694,-0.620118964711591,-0.731892704997143,-0.727122350169481,-0.770080890322644,-0.791322540770514,-0.853600934021509,-0.865262501310764,-0.938316355154244,-0.922429149886301,-0.934188473129987,-0.961401964763001,-0.971301149770816,-0.981032216193764,-0.999238090238608,-0.982592403918264,-0.985424383326693,-1.00106288082849,-0.990481940434366,-0.958371074216436,-0.968929283362586,-0.934231863873682,-0.921170366737085,-0.863649602238862,-0.837029281839097,-0.853918422797043,-0.808731499913646,-0.733527137902745,-0.710431510237867,-0.668811634234551,-0.616312024827155,-0.564521622092597,-0.502319064901986,-0.467779637402066,-0.418808573103844,-0.333520174642758,-0.244722024283060,-0.228877133398464,-0.185046975467644,-0.105024466087297,-0.0435365063867519,0.0199806056282154,0.0593825720365109,0.109050330487540,0.225643053782641,0.253442018616047,0.324386735113844,0.371239480328329,0.435956267496603,0.492071780146707,0.540583541230787,0.599993397917268,0.640617122040004,0.715060222256072,0.733080621106004,0.780729127997324,0.808588591307652,0.845822826773293,0.874974615561617,0.936599268235376,0.926338839678676,0.941217828468608,0.949223087850685,0.963386515958090,1.00574058293755,0.999589056637558,1.00101837940579,1.00583652158191,1.00865594974175,0.989583222961692,0.995340150182931,0.940098544082658,0.924025675983269,0.919151123394360,0.877295720398894,0.853163430478670,0.814441522129543,0.798474352152876,0.732502026979929,0.706172334188267,0.635299579090280,0.592276880447875,0.551634490422788,0.509570222456082,0.468378662331604,0.378838905317859,0.335916643881432,0.280717399760177,0.206462969737927,0.115320701705649,0.113068943254346,0.0449401082692309,0.00228956666228989,-0.0726891323144683,-0.152390763831705,-0.194392766581284,-0.282184479738781,-0.300577909360044,-0.363595390084896,-0.404584712724888,-0.472004683011018,-0.518938348517066,-0.557327446822514,-0.627980780398279,-0.661260417300849,-0.714957667512649,-0.744129903888157,-0.828337201711375,-0.854477855866025,-0.888943890888399,-0.923348099326124,-0.913526835751893,-0.943869744157377,-0.952247352331431,-0.948081509819726,-0.976114666203894,-0.983091560437233,-0.973622685844570,-1.01873218383355,-1.01066136149070,-0.998554327205659,-1.00812942198791,-0.968304099012474,-0.961534989515159,-0.924236593394775,-0.898559704502537,-0.848212698467403,-0.850046842032742,-0.781019952275844,-0.763671573637820,-0.727094227569519,-0.663428999101066,-0.601675386598232,-0.588165840147807,-0.500970544301911,-0.464644564131483,-0.434192063737780,-0.355319545473729,-0.309775835109920,-0.260884579037540,-0.185520495064930,-0.133058771542510,-0.0518434004440097,-0.0214829275897632,0.0613929145350731,0.149652079908689,0.208109472849775,0.264958057907093,0.304941166974884,0.365083369553854,0.401436577545880,0.462025357376419,0.529927120822412,0.579132964094238,0.632569540635558,0.677490453190983,0.707086349546543,0.755956339936891,0.766698537337467,0.818726387075215,0.839900526485269,0.919050224087260,0.918368887125529,0.930570815642531,0.929164605707379,0.980196145601826,0.974734936695454,1.00278921383255,0.972058667884519,1.00724062289320,1.00591491343793,0.995155254249138,0.955430001121551,0.967385467604974,0.957879684385685,0.914056701759084,0.891601751481147,0.876088301595802,0.841558980044055,0.800139016431241,0.807140206011264,0.725228754504940,0.696613755749731,0.638494889870499,0.624298713897946,0.529122613331607,0.499355378952440,0.413120942247625,0.365560191794158,0.322679674193281,0.282593168832742,0.207524761438338,0.126347198109816,0.0982630254484607,0.0386762805090835,-0.0190045185300961,-0.129286289954536,-0.174908877083245,-0.195812905070335,-0.297404420251131,-0.376792866014663,-0.409393534097958,-0.480109293804722,-0.500241276037489,-0.603244500838771,-0.624452990034600,-0.647841420625765,-0.698033454056802,-0.741046406451268,-0.788118987611543,-0.851362922971621,-0.858562819129274,-0.885634532190727,-0.896922466909439,-0.959247231055609,-0.988925274366617,-0.996849300721423,-1.01207797938053,-0.977985643036239,-0.997308050925263,-1.02535425094534,-1.00680163782895,-0.974411497590646,-0.980645515318602,-0.981346223410389,-0.994529532265236,-0.910868568739283,-0.913034236655283,-0.889599755346080,-0.840290390465155,-0.812559794897471,-0.795699286655552,-0.739291488064356,-0.686765431771323,-0.597583220941530,-0.618690525425264,-0.541325970794129,-0.454670087116989,-0.453291700148480,-0.355744432520917,-0.320260399094821,-0.256284862735976,-0.209945646281442,-0.151832257701899,-0.102196022642510,0.00241168866159707,0.0235941862998513,0.115896466110278,0.153992430641659,0.200852570958810,0.287419624150802,0.324742449340752,0.368341710142360,0.459905111797194,0.533005873587975,0.562180794780958,0.588674633417643,0.672433143605884,0.715480151938442,0.750037043743212,0.761081698711757,0.865848176566255,0.891745239252172,0.934701106057243,0.907811803883265,0.947357850004837,0.929226219139069,0.958976880757379,0.959895441746522,0.982800755919670,0.999804608155849,1.01665091584002,1.00721772488242,0.987857760433512,0.971149307492312,0.943761586745171,0.929789193734432,0.953933458504620,0.915306387202232,0.871694063715762,0.865570064566257,0.830526599754366,0.763846855092958,0.713946130837364,0.710496877278450,0.652349268170115,0.623441359086649,0.611523594318333,0.469959076530015,0.434917879752619,0.424405446096225,0.309289186550080,0.312727898266996,0.213004024996039,0.169753542344232,0.0665857425080338,0.0353662184669880,0.00186425192532158,-0.0787259870370425,-0.121495951221876,-0.190109016543348,-0.292558761994684,-0.284794435910986,-0.356502589663309,-0.414788239559731,-0.526059395857595,-0.530519794209757,-0.612087329533381,-0.663276282672566,-0.680948489193430,-0.721531199427323,-0.784640031689696,-0.804810440268638,-0.865420450150193,-0.904496650850353,-0.913684423734976,-0.890428249253960,-0.948206349674962,-0.921901741236108,-1.00077790513248,-1.00631697609831,-0.978031488608847,-1.00373596380844,-1.00531180751251,-1.00946913504995,-0.0394930829777978,-0.0243608041325779,-0.0174659427953647,-0.0579861445276742,-0.0303392918114284,-0.0295264359870508,-0.0397878332006835,-0.0203605145945226,-0.0500434311300032,-0.0118942881247591,-0.0464401606287325,-0.0340227107335953,-0.0170381352090719,-0.0294486550540742,-0.0467187809266446,-0.0302465930836499,-0.0410739043444019,-0.0133632057202548,0.00765805828079007,0.00508029598624702,-0.0124910609095994,-0.000744662754503888,-0.0335126963997887,-0.0282587379828348,0.00588881617394537,-0.0195798012580799,-0.0107022248068967,-0.0125480191312815,0.0409422048390635,0.00383555254908073,0.0274997690295353,0.0338026122784523,0.0190641767813419,0.0283817520475828,0.0601773245089861,0.0254339047063594,0.0344182590397283,0.0215753375676372,0.0612995302760550,0.0438372520515483,0.0618694096884775,0.0425995442918450,0.0571778011724677,0.0321844509913098,0.0428045520736851,0.0488677030398769,0.0413760574119672,0.0453506562937553,0.0612613686843513,0.0522270490085828,0.0608227396911612,0.0334423770890769,0.0342280060006742,0.0314464077303054,0.0432253686449182,0.0528885081721526,0.0359584315276196,0.0607441942214911,0.0510248472943955,0.0459100678244305,0.0424200780170257,0.0500886080256515,0.0332858323654937,0.0189178621338663,0.00670072373431483,-0.00582281320999806,-0.00434652922455630,0.00421418892891874,0.00380369930809534,0.0363110192570784,0.0300987340124125,0.0190395612638264,0.0199690851153409,0.00791299053602299,-0.0175124242889276,-0.0138429253064907,0.00503306388306738,0.00251676804958656,-0.0106758941699584,-0.0181247297679124,-0.0468184019024322,0.00807678542362458,-0.0306731826424386,-0.0398336063110370,-0.0617294425179693,-0.0386949040740478,-0.0288450773890596,-0.0478881887245326,-0.0399239991968188,-0.0102601613017709,-0.0451420743383080,-0.0604944078631197,-0.0526216991040233,-0.0675341325377299,-0.0470236089871117,-0.0473684408721869,-0.0172434591500401,-0.0473738627699703,-0.0487253365409313,-0.0557409363889717,-0.0217829026232795,-0.0459497433079832,-0.0288367356804643,-0.0277140322903246,-0.100037801532154,-0.0651747532976492,-0.0958206768927268,-0.0407946955684146,-0.0553773608972385,-0.0381958963866779,-0.0686986929289341,-0.0572886171904627,-0.0186042534587783,-0.00306706169578089,-0.0312385294968793,-0.101457639210786,-0.0418918353877615,0.000449810697678271,-0.0372358853757645,-0.0142141731509236,-0.00748052894508246,-0.0244825486520617,-0.0134171803933214,-0.0311097248688582,0.0151534313957880,0.0246511157326625,0.00983104528566383,-0.00132751568176202,3.21826222697769e-05,0.0245360432295702,0.000616600924689766,0.00708192143784846,0.0325941089096598,0.0212614114314506,0.00286387738920905,0.0244698155222541,0.0294993658899821,0.0722986695726423,0.0455753002409208,0.0206639348222642,0.0467566406775053,0.0276071821873702,0.0465868905905031,0.0265114728474644,0.0175680411325037,0.0640295634830740,0.0418526230779848,0.0712020770786788,0.0512303093804186,0.0546819701692429,0.0661098977291479,0.0580410339474267,0.0694477867451563,0.0634187023077201,0.0342457324360182,0.0643261045415140,0.0829826376654863,0.0201983676488628,0.0609479281965810,0.0286070293632062,0.0428257786945705,0.0572843972323026,0.0567775352629149,0.0657814410083689,0.0436240542485456,0.0432301981438366,0.0183611156903967,-0.00919375465244335,-0.00284873810797016,0.0191030128761711,0.00745190326971492,0.0164611963845640,0.0281020956236853,0.00205817481990333,0.00567734708103866,0.0272956266668252,0.0379954956762333,0.0160096786611548,-0.0155186223904139,0.000961526020593913,-0.0171821680864669,-0.00456646335963897,-0.0468030326922404,-0.0271665742786344,-0.0274493847516816,-0.0375656819650090,-0.00599251482304932,-0.0341804582397113,-0.0518774929855270,-0.0324818015542319,-0.0348783016569815,-0.0167180186798871,-0.0513388246937794,-0.0127683736252039,-0.0296619946335020,-0.0362689148099849,0.00835281807537747,0.00260848773429993,-0.0231051060447782,-0.0386040970359465,-0.0479475420045717,-0.0520769557481117,-0.0492537480104779,-0.0532181103301817,-0.0321361181136208,-0.0475485074607574,-0.0589971365474221,-0.0539752713229729,-0.0253523367060957,-0.0366142416191158,-0.0149128085832455,-0.0367021071295391,-0.0392872610689597,-0.0627056108603290,-0.0356627618032311,-0.0267361129842553,-0.0166931369564525,-0.0302217107152513,-0.00888190098235257,-0.0274040373093569,-0.0178362249994321,-0.0200411133804194,-0.0291800740733761,0.00265653743182272,-0.0203510164272670,0.00227992687151940,0.00975366099224303,-0.0101415834480137,0.00634618505326597,-0.00984232893361101,0.0480121588364087,-0.0216266290640834,0.0194163206456589,-0.000284445000300339,0.0106103057506711,-0.00276347764879710,0.0361551007463306,0.0288632778287647,0.0436315716786027,0.0108368100734914,0.0357740089172627,0.0174133484439493,0.0539413133010382,0.0459420452741782,0.0240221739052584,0.0782387541539172,0.0433042467497897,0.0538577914235026,0.0324541598903290,0.00492879398417716,0.0261498982283875,0.0226355161335341,0.0396870093478588,0.0373634448416210,0.0618694000824384,0.0366767155372516,0.0496856707519008,0.0391103641930243,0.0264369161116980,0.0312988772147640,0.0487926897184305,0.0392078885341780,0.0190528411987236,0.0353688128259479,0.0237663641438235,0.0236372325147348,0.0494308095906141,0.0268568030729291,0.0377223779354186,0.00853424663851223,0.0420416484084055,0.0322269807200545,0.00148482244502364,0.0362641542498510,0.00812343227882587,-0.00589877240999424,0.0251920706637927,-0.00231147746559357,-0.00660003132399899,-0.0247603917495293,-0.0413566915816090,-0.0358176438395125,-0.00768215655821773,-0.0123088044818193,-0.0387552559047624,0.00557258950280828,-0.0140035063036464,-0.0370990204050949,-0.0294714171073668,-0.0219534287575481,-0.0132778004796982,-0.0268081416178157,-0.0490645527669795,-0.000399296412917180,-0.0243539426576328,-0.00557473489070173,-0.0298208034793984,-0.0571385350418949,-0.00656772691106516,-0.0403384497410799,-0.0370902561903687,-0.0559841031210666,-0.0427230852678596,-0.0432335618419984,-0.0517060822499389,0.00123339020708631,-0.0321988532558407,-0.0451980451240973,-0.0369847057120492,-0.0252446113534565,-0.0317819065361518,-0.0636877343770965,-0.0347487285812581,-0.0244629869679009,-0.0595551300938112,-0.0348600369504237,-0.0655307237719275,-0.0249800426302744,-0.0510818260446098,-0.0439816297827858,-0.0293146207430182,-0.0564181605157918,0.00217159067335909,-0.441473186506375,-0.347934438405812,-0.305134775533477,-0.243435658166128,-0.171612510940413,-0.0942774051865769,-0.0524976783407317];
if addnoise
    x4=noisegen(x4,snr);
end
[st4_sig,st4_t,st4_f] = st(hilbert(x4'));
x4_t=max(abs(st4_sig));%找出各个列向量的最大值;
%求得Tup,Tdown,Tinter
Tupindex=find(x4_t>1.1);
if(isempty(Tupindex))
    Tup=0;
else
    Tup=(Tupindex(end)-Tupindex(1))/fs;
end
Tdownindex=find(x4_t<0.9);
if(isempty(Tdownindex))
    Tdown=0;
else
    Tdown=(Tdownindex(end)-Tdownindex(1))/fs;
end
Tinterindex=find(x4_t<0.1);
if(isempty(Tinterindex))
    Tinter=0;
else
    Tinter=(Tinterindex(end)-Tinterindex(1))/fs;
    Tdown=0;
end
disp('-----中断电压信号-----');
disp(['中断电压信号起始时刻t1：' num2str(t1) ' 结束时刻t2：' num2str(t2) ' 骤升时间是:' num2str(Tup) ' 骤降时间是：' num2str(Tdown) ' 中断时间是：' num2str(Tinter)]);
%求均值和标准差;
x4tmean=mean(x4_t);
x4tstd=std(x4_t);
disp(['电压中断信号时域特性曲线的均值是:' num2str(x4tmean)]);
disp(['电压中断信号时域特性曲线的标准差是:' num2str(x4tstd)]);
x4_f=max(abs(st4_sig),[],2);%找出各个行向量的最大值;
%求峰值
pks=findpeaks(x4_f(10:end));
if length(pks)==1
    disp(['电压中断信号p1:' num2str(pks(1)) ' p2:0 p3:0']);
elseif length(pks)==2
    disp(['电压中断信号p1:' num2str(pks(1)) ' p2:' num2str(pks(2)) ' p3:0']);
else
    disp(['电压中断信号p1:' num2str(pks(1)) ' p2:' num2str(pks(1)) ' p3:' num2str(pks(3))]);
end
%求均值和标准差;
x4fmean=mean(x4_f);
x4fstd=std(x4_f);
disp(['电压中断信号频域特性曲线的均值是:' num2str(x4fmean)]);
disp(['电压中断信号频域特性曲线的标准差是:' num2str(x4fstd)]);

%% ----谐波信号:x5----
a5=rand(1,1)*0.2;%3次谐波含量在0~0.2之间;
b5=rand(1,1)*0.2;%5次谐波含量在0~0.2之间;
c5=rand(1,1)*0.2;%7次谐波含量在0~0.2之间;
x5=sin(2*pi*f0*n/fs)+a5*sin(2*pi*3*f0*n/fs)+b5*sin(2*pi*5*f0*n/fs)+c5*sin(2*pi*7*f0*n/fs);
if addnoise
    x5=noisegen(x5,snr);
end
[st5_sig,st5_t,st5_f] = st(hilbert(x5'));
x5_t=max(abs(st5_sig));%找出各个列向量的最大值;
%求得Tup,Tdown,Tinter
Tupindex=find(x5_t>1.1);
if(isempty(Tupindex))
    Tup=0;
else
    Tup=(Tupindex(end)-Tupindex(1))/fs;
end
Tdownindex=find(x5_t<0.9);
if(isempty(Tdownindex))
    Tdown=0;
else
    Tdown=(Tdownindex(end)-Tdownindex(1))/fs;
end
Tinterindex=find(x5_t<0.1);
if(isempty(Tinterindex))
    Tinter=0;
else
    Tinter=(Tinterindex(end)-Tinterindex(1))/fs;
end
disp('-----谐波电压信号-----');
disp(['谐波信号起始时刻t1：' num2str(t1) ' 结束时刻t2：' num2str(t2) ' 骤升时间是:' num2str(Tup) ' 骤降时间是：' num2str(Tdown) ' 中断时间是：' num2str(Tinter)]);
%求均值和标准差;
x5tmean=mean(x5_t);
x5tstd=std(x5_t);
disp(['谐波信号时域特性曲线的均值是:' num2str(x5tmean)]);
disp(['谐波信号时域特性曲线的标准差是:' num2str(x5tstd)]);
x5_f=max(abs(st5_sig),[],2);%找出各个行向量的最大值;
%求峰值
pks=findpeaks(x5_f(10:end));
disp(['谐波信号p1:' num2str(pks(1)) ' p2:' num2str(pks(2)) ' p3:' num2str(pks(3))]);
%求均值和标准差;
x5fmean=mean(x5_f);
x5fstd=std(x5_f);
disp(['谐波信号频域特性曲线的均值是:' num2str(x5fmean)]);
disp(['谐波信号频域特性曲线的标准差是:' num2str(x5fstd)]);

%% ----骤升+谐波信号:x6----
a2=0.1+rand(1,1)*0.7;%骤升比例系数;
t1=0;
t2=0;
while (t2-t1<0.02)||(t2-t1 > 0.18)%不满足约束条件:T<t2-t1<9T，则一直为真；
    t1=rand(1,1)*0.18;%0.02=<t2-t1=<0.18;
    t2=0.02+rand(1,1)*0.18;
end
ntemp=0:N-1;
u1step=(ntemp-t1*fs)>=0;%求出t1的阶跃点;
u2step=(ntemp-t2*fs)>=0;%求出t2的阶跃点;
a6=rand(1,1)*0.2;
b6=rand(1,1)*0.2;
c6=rand(1,1)*0.2;
x6=(1+a2*(u1step-u2step)).*(sin(2*pi*f0*n/fs)+a6*sin(2*pi*3*f0*n/fs)+b6*sin(2*pi*5*f0*n/fs)+c6*sin(2*pi*7*f0*n/fs));
if addnoise
    x6=noisegen(x6,snr);
end
[st6_sig,st6_t,st6_f] = st(hilbert(x6'));
x6_t=max(abs(st6_sig));%找出各个列向量的最大值;
%求得Tup,Tdown,Tinter
Tupindex=find(x6_t>1.1);
if(isempty(Tupindex))
    Tup=0;
else
    Tup=(Tupindex(end)-Tupindex(1))/fs;
end
Tdownindex=find(x6_t<0.9);
if(isempty(Tdownindex))
    Tdown=0;
else
    Tdown=(Tdownindex(end)-Tdownindex(1))/fs;
end
Tinterindex=find(x6_t<0.1);
if(isempty(Tinterindex))
    Tinter=0;
else
    Tinter=(Tinterindex(end)-Tinterindex(1))/fs;
end
disp('-----骤升+谐波电压信号-----');
disp(['电压骤升+谐波信号起始时刻t1：' num2str(t1) ' 结束时刻t2：' num2str(t2) ' 骤升时间是:' num2str(Tup) ' 骤降时间是：' num2str(Tdown) ' 中断时间是：' num2str(Tinter)]);
%求均值和标准差;
x6tmean=mean(x6_t);
x6tstd=std(x6_t);
disp(['电压骤升+谐波信号时域特性曲线的均值是:' num2str(x6tmean)]);
disp(['电压骤升+谐波信号时域特性曲线的标准差是:' num2str(x6tstd)]);
x6_f=max(abs(st6_sig),[],2);%找出各个行向量的最大值;
%求峰值
pks=findpeaks(x6_f(10:end));
disp(['电压骤升+谐波信号p1:' num2str(pks(1)) ' p2:' num2str(pks(2)) ' p3:' num2str(pks(3))]);
%求均值和标准差;
x6fmean=mean(x6_f);
x6fstd=std(x6_f);
disp(['电压骤升+谐波信号频域特性曲线的均值是:' num2str(x6fmean)]);
disp(['电压骤升+谐波信号频域特性曲线的标准差是:' num2str(x6fstd)]);

%% ----电压骤降+谐波信号:x7----
a2=0.1+rand(1,1)*0.8;%骤降比例系数;
t1=0;
t2=0;
while (t2-t1<0.02)||(t2-t1 > 0.18)%不满足约束条件:T<t2-t1<9T，则一直为真；
    t1=rand(1,1)*0.18;%0.02=<t2-t1=<0.18;
    t2=0.02+rand(1,1)*0.18;
end
ntemp=0:N-1;
u1step=(ntemp-t1*fs)>=0;%求出t1的阶跃时刻;
u2step=(ntemp-t2*fs)>=0;%求出t2的阶跃时刻;
a7=rand(1,1)*0.2;
b7=rand(1,1)*0.2;
c7=rand(1,1)*0.2;
x7=(1-a2*(u1step-u2step)).*(sin(2*pi*f0*n/fs)+a7*sin(2*pi*3*f0*n/fs)+b7*sin(2*pi*5*f0*n/fs)+c7*sin(2*pi*7*f0*n/fs));
if addnoise
    x7=noisegen(x7,snr);
end
[st7_sig,st7_t,st7_f] = st(hilbert(x7'));
x7_t=max(abs(st7_sig));%找出各个列向量的最大值;
%求得Tup,Tdown,Tinter
Tupindex=find(x7_t>1.1);
if(isempty(Tupindex))
    Tup=0;
else
    Tup=(Tupindex(end)-Tupindex(1))/fs;
end
Tdownindex=find(x7_t<0.9);
if(isempty(Tdownindex))
    Tdown=0;
else
    Tdown=(Tdownindex(end)-Tdownindex(1))/fs;
end
Tinterindex=find(x7_t<0.1);
if(isempty(Tinterindex))
    Tinter=0;
else
    Tinter=(Tinterindex(end)-Tinterindex(1))/fs;
end
disp('-----骤降+谐波电压信号-----');
disp(['电压骤降+谐波信号起始时刻t1：' num2str(t1) ' 结束时刻t2：' num2str(t2) ' 骤升时间是:' num2str(Tup) ' 骤降时间是：' num2str(Tdown) ' 中断时间是：' num2str(Tinter)]);
%求均值和标准差;
x7tmean=mean(x7_t);
x7tstd=std(x7_t);
disp(['电压骤降+谐波信号时域特性曲线的均值是:' num2str(x7tmean)]);
disp(['电压骤降+谐波信号时域特性曲线的标准差是:' num2str(x7tstd)]);
x7_f=max(abs(st7_sig),[],2);%找出各个行向量的最大值;
%求峰值
pks=findpeaks(x7_f(10:end));
disp(['电压骤降+谐波信号p1:' num2str(pks(1)) ' p2:' num2str(pks(2)) ' p3:' num2str(pks(3))]);
%求均值和标准差;
x7fmean=mean(x7_f);
x7fstd=std(x7_f);
disp(['电压骤降+谐波信号频域特性曲线的均值是:' num2str(x7fmean)]);
disp(['电压骤降+谐波信号频域特性曲线的标准差是:' num2str(x7fstd)]);
